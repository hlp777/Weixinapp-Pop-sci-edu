# 科普知识挑战页云开发设置指南

## 环境配置

### 1. 云开发环境
- 环境ID: `cloud1-5g5ff36n3f39ffad`
- 已在 `app.js` 中配置

### 2. 云函数部署

需要部署以下云函数：

1. **get-questions** - 获取题目列表
2. **save-quiz-record** - 保存答题记录
3. **get-quiz-records** - 获取用户答题记录
4. **init-questions** - 初始化题目数据

### 3. 数据库集合

需要创建以下数据库集合：

1. **questions** - 题目数据
2. **quiz_records** - 答题记录

## 部署步骤

### 1. 部署云函数

在微信开发者工具中：

1. 右键 `cloudfunctions` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待所有云函数部署完成

### 2. 初始化题目数据

#### 方法一：使用简单初始化函数（推荐）
1. 在云开发控制台中，进入"云函数"
2. 找到 `simple-init-questions` 函数
3. 点击"测试"按钮
4. 执行函数，添加测试题目

#### 方法二：使用管理页面
1. 在小程序中打开 `pages/admin/admin` 页面
2. 点击"初始化简单题目"按钮
3. 或者手动添加题目

#### 方法三：使用原始初始化函数
1. 在云开发控制台中，进入"云函数"
2. 找到 `init-questions` 函数
3. 点击"测试"按钮
4. 执行函数，添加15道题目

### 3. 设置数据库权限

在云开发控制台中，进入"数据库"：

1. 创建 `questions` 集合
2. 创建 `quiz_records` 集合
3. 设置权限为"所有用户可读，仅创建者可写"

## 功能特性

### 1. 题目管理
- 支持按分类筛选题目（航天、农业、工业、科学）
- 支持按难度筛选（简单、中等、困难）
- 随机抽取指定数量的题目
- 本地备用题目机制

### 2. 答题功能
- 实时答题进度显示
- 即时反馈（正确/错误）
- 答题时长统计
- 支持上一题/下一题导航

### 3. 数据存储
- 云数据库存储答题记录
- 本地存储备份
- 用户答题历史查询
- 成绩统计分析

### 4. 用户体验
- 加载状态提示
- 错误处理和重试机制
- 答题完成后的详细分析
- 支持重新答题

## 题目数据结构

```javascript
{
  id: 1,
  question: "题目内容",
  options: ["选项A", "选项B", "选项C", "选项D"],
  answer: 1, // 正确答案索引
  explanation: "答案解析",
  category: "space", // 分类：space/agriculture/industry/science
  difficulty: "easy" // 难度：easy/medium/hard
}
```

## 答题记录数据结构

```javascript
{
  userId: "用户ID",
  score: 80, // 得分
  correctCount: 4, // 正确题数
  wrongCount: 1, // 错误题数
  totalQuestions: 5, // 总题数
  userAnswers: [1, 2, 0, 3, 1], // 用户答案
  questions: [...], // 题目信息
  duration: 120, // 答题时长（秒）
  createTime: "2025-01-XX", // 创建时间
  updateTime: "2025-01-XX" // 更新时间
}
```

## 测试方法

### 1. 功能测试
1. 打开答题页面
2. 检查题目是否正确加载
3. 完成答题流程
4. 查看答题记录是否正确保存

### 2. 云函数测试
1. 在云开发控制台测试各个云函数
2. 检查数据库中的数据是否正确
3. 验证权限设置是否生效

### 3. 错误处理测试
1. 断网情况下测试本地备用题目
2. 云函数调用失败时的降级处理
3. 数据保存失败时的提示

## 故障排除

### 1. init-questions 云函数不能使用

**问题原因**：
- 云函数中使用了不支持的 `remove()` 方法
- 批量操作可能超时
- 环境ID配置错误

**解决方案**：
1. 使用 `simple-init-questions` 函数（推荐）
2. 使用管理页面手动添加题目
3. 检查云开发环境ID是否正确

### 2. 题目不显示

**问题原因**：
- 数据库中没有题目数据
- 云函数调用失败
- 权限设置问题

**解决方案**：
1. 先使用本地题目确保基本功能
2. 检查云函数是否正常部署
3. 验证数据库权限设置

### 3. 云函数调用失败

**问题原因**：
- 云函数未正确部署
- 环境ID不匹配
- 网络问题

**解决方案**：
1. 重新部署云函数
2. 检查环境ID配置
3. 查看云函数日志

## 注意事项

1. 确保云开发环境ID正确配置
2. 云函数部署后需要等待几分钟才能生效
3. 数据库权限设置要合理，避免安全风险
4. 题目数据可以根据需要随时更新
5. 建议定期备份重要的答题记录数据
6. 优先使用简单初始化函数避免复杂操作

## 扩展功能

可以考虑添加的功能：

1. 题目分类管理界面
2. 难度等级自定义
3. 答题排行榜
4. 题目收藏功能
5. 错题本功能
6. 答题统计图表
7. 社交分享功能
