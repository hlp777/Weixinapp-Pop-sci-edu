<!--pages/quiz/quiz.wxml-->
<view class="page">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="header-title">ç§‘æ™®çŸ¥è¯†æŒ‘æˆ˜</view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-view" wx:if="{{loading}}">
      <view class="loading-icon">ğŸ“š</view>
      <view class="loading-text">æ­£åœ¨åŠ è½½é¢˜ç›®...</view>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view class="error-view" wx:elif="{{!loading && questions.length === 0}}">
      <view class="error-icon">âŒ</view>
      <view class="error-text">åŠ è½½é¢˜ç›®å¤±è´¥</view>
      <button class="btn primary" bindtap="loadQuestions">é‡æ–°åŠ è½½</button>
    </view>

    <!-- ç­”é¢˜è§†å›¾ -->
    <view class="quiz-view" wx:elif="{{!showResult && questions.length > 0}}">
      <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
      <view class="progress-container">
        <view class="progress-text">{{currentIndex + 1}}/{{questions.length}}</view>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{(currentIndex / questions.length) * 100}}%"></view>
        </view>
      </view>

      <!-- é¢˜ç›®åŒºåŸŸ -->
      <view class="question-container">
        <view class="question-text">{{questions[currentIndex].question}}</view>
        <view class="options">
          <view class="option" 
                wx:for="{{questions[currentIndex].options}}" 
                wx:key="index"
                bindtap="selectOption"
                data-index="{{index}}"
                style="border-color: {{selectedIndex === index ? (index === questions[currentIndex].answer ? '#22c55e' : '#ef4444') : '#e5e7eb'}}">
            {{item}}
          </view>
        </view>
      </view>

      <!-- æ§åˆ¶æŒ‰é’® -->
      <view class="controls">
        <button class="btn" bindtap="prevQuestion" disabled="{{currentIndex === 0}}">ä¸Šä¸€é¢˜</button>
        <button class="btn" bindtap="nextQuestion" disabled="{{selectedIndex === -1}}">ä¸‹ä¸€é¢˜</button>
        <button class="btn primary" bindtap="submitQuiz" wx:if="{{currentIndex === questions.length - 1}}" disabled="{{selectedIndex === -1}}">æäº¤ç­”æ¡ˆ</button>
      </view>

      <!-- åé¦ˆä¿¡æ¯ -->
      <view class="feedback" wx:if="{{showFeedback}}">
        {{feedbackText}}
      </view>
    </view>

    <!-- ç»“æœè§†å›¾ -->
    <view class="result-view" wx:if="{{showResult}}">
      <view class="result-title">æˆç»©</view>
      <view class="score">{{score}}åˆ†</view>
      <view class="stats">æ­£ç¡® {{correctCount}} é¢˜ï½œé”™è¯¯ {{wrongCount}} é¢˜</view>
      <view class="duration">ç­”é¢˜æ—¶é•¿ï¼š{{duration}}ç§’</view>
      
      <!-- ç­”æ¡ˆè§£æ -->
      <view class="analysis">
        <view class="analysis-title">ç­”æ¡ˆè§£æ</view>
        <view class="analysis-item" wx:for="{{questions}}" wx:key="index">
          <view class="analysis-question">Q{{index + 1}}: {{item.question}}</view>
          <view class="analysis-answer">ä½ çš„é€‰æ‹©ï¼š{{userAnswers[index] !== -1 ? item.options[userAnswers[index]] : 'æœªé€‰æ‹©'}}</view>
          <view class="analysis-correct">æ­£ç¡®ç­”æ¡ˆï¼š{{item.options[item.answer]}}</view>
          <view class="analysis-explain">è§£æï¼š{{item.explanation}}</view>
        </view>
      </view>

      <button class="btn primary" bindtap="retryQuiz">å†è¯•ä¸€æ¬¡</button>
    </view>
  </view>

  <!-- åº•éƒ¨æ—¶é—´æ˜¾ç¤º -->
  <view class="footer">
    <view class="time">{{currentTime}}</view>
  </view>
</view>
